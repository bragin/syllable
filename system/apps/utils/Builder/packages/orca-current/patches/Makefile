#----------------------------------------------------------------------------
# Makefile for GNU make
# Generated by m2 at 12-Dec-2005/21:14:54+1:00
# Project: orca
#----------------------------------------------------------------------------


#------ Compiler and tools

CC       = gcc
CXX      = g++
LINK	 = gcc
LINK_CXX = g++
TAR      = tar -cf
GZIP	 = gzip -9f
MOC      = $(QTDIR)/bin/moc


#------ Target settings

ORCA_CFLAGS   = -DOR_CONFIG_BYTECODE -DOR_CONFIG_COMPRESS -DOR_CONFIG_HEX_TOKEN -DOR_CONFIG_MATH3D -std=gnu99 -DLANG_ORCA -pipe -Wall -W -g -DDEBUG 
ORCA_CXXFLAGS = $(ORCA_CFLAGS) 
ORCA_INCPATH  = -Iunix -I.
ORCA_LFLAGS   = 
ORCA_LIBS     =  
ORCA_SOURCES  = 	ovalue.c \
	context.c \
	array.c \
	parse.c \
	charset.c \
	series.c \
	op.c \
	error.c \
	tokenize.c \
	bytecode.c \
	gc.c \
	print.c \
	math.c \
	math3d.c \
	files.c \
	support/mt19937ar.c \
	unix/os.c \
	stdio.c

ORCA_OBJECTS  = 	obj/ovalue.o \
	obj/context.o \
	obj/array.o \
	obj/parse.o \
	obj/charset.o \
	obj/series.o \
	obj/op.o \
	obj/error.o \
	obj/tokenize.o \
	obj/bytecode.o \
	obj/gc.o \
	obj/print.o \
	obj/math.o \
	obj/math3d.o \
	obj/files.o \
	obj/mt19937ar.o \
	obj/os.o \
	obj/stdio.o



OCORE_CFLAGS   = -DOR_CONFIG_BYTECODE -DOR_CONFIG_COMPRESS -DOR_CONFIG_HEX_TOKEN -DOR_CONFIG_MATH3D -std=gnu99 -pipe -Wall -W -g -DDEBUG 
OCORE_CXXFLAGS = $(OCORE_CFLAGS) 
OCORE_INCPATH  = -Iunix
OCORE_LFLAGS   = $(LDFLAGS)
OCORE_LIBS     = -L. -lorca -lm -lbz2
OCORE_SOURCES  = 	console.c

OCORE_OBJECTS  = 	obj/console.o


ARCHIVE = orca
DIST_FILES = \
	README \
	LICENSE \
	ChangeLog \
	TODO \
	config.r \
	boot.r \
	boot_str.r \
	boot_bin.r \
	unix \
	win32 \
	tests/Makefile \
	tests/run_test \
	tests/working \
	support/bzip2 \
	util \
	qt/project.r \
	qt/qorca.h \
	qt/main.cpp \
	qt/qorca.cpp \
	qt/win32console.cpp \
	qt/oconf.r \
	gl/*.c \
	gl/*.h \
	gl/*.r \
	gl/glv \
	gl/demo \
	boot.c \
	charset.h \
	internal.h \
	math3d.h \
	ovalue.h \
	version.h


#------ Build rules

all: liborca.a ocore
 
liborca.a: $(ORCA_OBJECTS)
	ar rc $@ $(ORCA_OBJECTS) $(ORCA_LFLAGS)
	ranlib $@
 
ocore: $(OCORE_OBJECTS) liborca.a
	$(LINK) -o $@ $(OCORE_LFLAGS) $(OCORE_OBJECTS) $(OCORE_LIBS)


Makefile: project.r
	m2 project.r

.PHONY: dist
dist:
	$(TAR) $(ARCHIVE).tar --exclude CVS --exclude .svn --exclude *.o project.r obj/ $(ORCA_SOURCES) $(OCORE_SOURCES) $(DIST_FILES)
	mkdir /tmp/$(ARCHIVE)
	tar -C /tmp/$(ARCHIVE) -xf $(ARCHIVE).tar
	tar -C /tmp -cf $(ARCHIVE).tar $(ARCHIVE)
	rm -rf /tmp/$(ARCHIVE)
	$(GZIP) $(ARCHIVE).tar

.PHONY: clean
clean:
	-rm -f core
	-rm -f liborca.a $(ORCA_OBJECTS)
	-rm -f ocore $(OCORE_OBJECTS)


#------ Compile rules

obj/ovalue.o: ovalue.c \
	boot.c \
	internal.h \
	ovalue.h
	$(CC) -c $(ORCA_CFLAGS) -o obj/ovalue.o $(ORCA_INCPATH) ovalue.c

obj/context.o: context.c \
	internal.h \
	ovalue.h
	$(CC) -c $(ORCA_CFLAGS) -o obj/context.o $(ORCA_INCPATH) context.c

obj/array.o: array.c \
	ovalue.h
	$(CC) -c $(ORCA_CFLAGS) -o obj/array.o $(ORCA_INCPATH) array.c

obj/parse.o: parse.c \
	charset.h \
	ovalue.h
	$(CC) -c $(ORCA_CFLAGS) -o obj/parse.o $(ORCA_INCPATH) parse.c

obj/charset.o: charset.c
	$(CC) -c $(ORCA_CFLAGS) -o obj/charset.o $(ORCA_INCPATH) charset.c

obj/series.o: series.c \
	charset.h \
	internal.h \
	ovalue.h
	$(CC) -c $(ORCA_CFLAGS) -o obj/series.o $(ORCA_INCPATH) series.c

obj/op.o: op.c \
	ovalue.h
	$(CC) -c $(ORCA_CFLAGS) -o obj/op.o $(ORCA_INCPATH) op.c

obj/error.o: error.c \
	internal.h \
	ovalue.h
	$(CC) -c $(ORCA_CFLAGS) -o obj/error.o $(ORCA_INCPATH) error.c

obj/tokenize.o: tokenize.c \
	charset.h \
	ovalue.h
	$(CC) -c $(ORCA_CFLAGS) -o obj/tokenize.o $(ORCA_INCPATH) tokenize.c

obj/bytecode.o: bytecode.c \
	ovalue.h
	$(CC) -c $(ORCA_CFLAGS) -o obj/bytecode.o $(ORCA_INCPATH) bytecode.c

obj/gc.o: gc.c \
	internal.h \
	ovalue.h
	$(CC) -c $(ORCA_CFLAGS) -o obj/gc.o $(ORCA_INCPATH) gc.c

obj/print.o: print.c \
	internal.h \
	ovalue.h
	$(CC) -c $(ORCA_CFLAGS) -o obj/print.o $(ORCA_INCPATH) print.c

obj/math.o: math.c \
	internal.h \
	ovalue.h
	$(CC) -c $(ORCA_CFLAGS) -o obj/math.o $(ORCA_INCPATH) math.c

obj/math3d.o: math3d.c \
	math3d.h \
	ovalue.h
	$(CC) -c $(ORCA_CFLAGS) -o obj/math3d.o $(ORCA_INCPATH) math3d.c

obj/files.o: files.c \
	ovalue.h
	$(CC) -c $(ORCA_CFLAGS) -o obj/files.o $(ORCA_INCPATH) files.c

obj/mt19937ar.o: support/mt19937ar.c
	$(CC) -c $(ORCA_CFLAGS) -o obj/mt19937ar.o $(ORCA_INCPATH) support/mt19937ar.c

obj/os.o: unix/os.c \
	ovalue.h
	$(CC) -c $(ORCA_CFLAGS) -o obj/os.o $(ORCA_INCPATH) unix/os.c

obj/stdio.o: stdio.c \
	ovalue.h
	$(CC) -c $(ORCA_CFLAGS) -o obj/stdio.o $(ORCA_INCPATH) stdio.c

obj/console.o: console.c \
	ovalue.h \
	version.h
	$(CC) -c $(OCORE_CFLAGS) -o obj/console.o $(OCORE_INCPATH) console.c


#EOF
